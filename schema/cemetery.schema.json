{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/cemetery.schema.json",
  "title": "Cemetery Data Schema",
  "description": "Schema for cemetery data including cemetery info, graves, and change logs",
  "type": "object",
  "required": ["schema_version", "cemetery", "graves"],
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Version of the schema",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "cemetery": {
      "type": "object",
      "description": "Cemetery information",
      "required": ["id", "name", "grid", "last_modified", "modified_by"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique cemetery identifier"
        },
        "name": {
          "type": "string",
          "description": "Cemetery name"
        },
        "grid": {
          "type": "object",
          "description": "Grid layout configuration",
          "required": ["rows", "cols"],
          "properties": {
            "rows": {
              "type": "integer",
              "minimum": 1
            },
            "cols": {
              "type": "integer",
              "minimum": 1
            },
            "cellSize": {
              "type": "integer",
              "minimum": 1
            }
          }
        },
        "last_modified": {
          "type": "string",
          "format": "date-time",
          "description": "Last modification timestamp"
        },
        "modified_by": {
          "type": "string",
          "description": "User who last modified"
        },
        "license": {
          "type": "string",
          "description": "Data license"
        }
      }
    },
    "graves": {
      "type": "array",
      "description": "List of graves in the cemetery",
      "items": {
        "type": "object",
        "required": ["uuid", "plot", "grid", "properties"],
        "properties": {
          "uuid": {
            "type": "string",
            "description": "Unique grave identifier (UUID v4)",
            "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"
          },
          "plot": {
            "type": "string",
            "description": "Plot identifier"
          },
          "grid": {
            "type": "object",
            "description": "Grid position",
            "required": ["row", "col"],
            "properties": {
              "row": {
                "type": "integer",
                "minimum": 0
              },
              "col": {
                "type": "integer",
                "minimum": 0
              }
            }
          },
          "geometry": {
            "type": "object",
            "description": "GeoJSON Point geometry",
            "properties": {
              "type": {
                "type": "string",
                "enum": ["Point"]
              },
              "coordinates": {
                "type": "array",
                "items": {
                  "type": "number"
                },
                "minItems": 2,
                "maxItems": 2
              }
            }
          },
          "properties": {
            "type": "object",
            "required": ["last_modified", "modified_by"],
            "additionalProperties": false,
            "properties": {
              "name": {
                "type": "string",
                "description": "Name of the deceased"
              },
              "birth": {
                "anyOf": [
                  { "type": "string", "format": "date" },
                  { "type": "string", "maxLength": 0 }
                ],
                "description": "Birth date (YYYY-MM-DD format or empty)"
              },
              "death": {
                "anyOf": [
                  { "type": "string", "format": "date" },
                  { "type": "string", "maxLength": 0 }
                ],
                "description": "Death date (YYYY-MM-DD format or empty)"
              },
              "inscription": {
                "type": "string",
                "description": "Inscription text on the grave marker"
              },
              "notes": {
                "type": "string",
                "description": "Additional notes or observations"
              },
              "deleted": {
                "type": "boolean",
                "description": "Whether the grave record is marked as deleted"
              },
              "last_modified": {
                "type": "string",
                "format": "date-time",
                "description": "When this record was last modified"
              },
              "modified_by": {
                "type": "string",
                "description": "User who last modified this record"
              }
            }
          }
        }
      }
    },
    "change_log": {
      "type": "array",
      "description": "History of changes to the cemetery data",
      "items": {
        "type": "object",
        "required": ["op", "uuid", "changes", "timestamp", "user"],
        "properties": {
          "op": {
            "type": "string",
            "enum": ["set", "delete"],
            "description": "Operation type"
          },
          "uuid": {
            "type": "string",
            "description": "UUID of affected grave"
          },
          "changes": {
            "type": "object",
            "description": "Changed fields"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "When the change occurred"
          },
          "user": {
            "type": "string",
            "description": "User who made the change"
          }
        }
      }
    }
  }
}
